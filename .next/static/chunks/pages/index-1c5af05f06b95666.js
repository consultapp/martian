(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5557:function(e,s,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return l(1127)}])},1127:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return x}});var n=l(5893),t=l(9008),a=l.n(t),r=l(7294),i=l(8433);function c(e){return"__FIELD_".concat(e,"__")}function d(e,s){let l=e;return e&&s&&(l=Object.entries(s).reduce((e,s)=>{let[l,n]=s;return e.replace(c(l.toUpperCase()),n)},e)),l}function o(e){let{svg:s,fields:l,alt:t="vizitka svg"}=e,a=d(s,l);return(0,n.jsx)("div",{className:"svg_render",children:a?(0,n.jsx)("img",{src:"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a),width:"100%",alt:t}):(0,n.jsx)("div",{className:"placeholder place-hold",children:"placeholder"})})}let u=e=>{let{svg:s,startFields:l,handleRefresh:t}=e,[a,c]=(0,r.useState)(l),[u,m]=(0,r.useState)(""),f=(0,r.useRef)(null);function v(e){let{target:s}=e,l={...a};l[s.name]=s.value,c(l)}async function h(e){m((0,n.jsx)("div",{className:"spinner-border text-primary m-2",role:"status",children:"\xa0"})),i.Z.post("/api/getPdf",d(s[e],a),{headers:{"Content-Type":"image/svg+xml"}}).then(e=>{let{data:s}=e;m((0,n.jsx)("a",{href:"/static/1.pdf",className:"btn btn-primary",ref:f,download:"vizitka.pdf",children:"Скачать"},s))}).catch(e=>{console.error(e)})}let x=s.map((e,s)=>e?(0,n.jsx)("div",{className:"col",children:(0,n.jsx)(o,{svg:e,fields:a,alt:"Svg".concat(s)})},s):(0,n.jsx)("div",{className:"col",children:"Нет второго шаблона"})),j=a?Object.entries(a).map(e=>{let[s,l]=e;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"form-lable",children:[s,": "]}),(0,n.jsx)("input",{className:"form-control",value:l,name:s,id:s,onChange:v})]},s)}):"",g=(0,n.jsxs)("div",{className:"edit-form-buttons",children:[(0,n.jsx)("button",{className:"btn btn-secondary outline m-2",onClick:e=>{e.preventDefault(),t()},children:"< Выбрать шаблоны"}),(0,n.jsx)("button",{className:"btn btn-primary m-2",onClick:e=>{e.preventDefault(),h(0)},children:"Make PDF"}),u]});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("h1",{children:"Редактирование шаблонов"})}),(0,n.jsx)("div",{className:"row",children:x}),(0,n.jsxs)("form",{children:[(0,n.jsx)("div",{className:"row",children:j}),(0,n.jsx)("div",{className:"row",children:g})]})]})},m=[{tag:"NAME",mock:"Имя"},{tag:"SURNAME",mock:"Фамилия"},{tag:"JOBTITLE",mock:"Должность"},{tag:"PHONE",mock:"+7(999)999-99-99"},{tag:"SITE",mock:"https://site.ru"},{tag:"EMAIL",mock:"mail@site.ru"},{tag:"COMPANYNAME",mock:"Название компании"}];function f(e){let{handleFilesLoaded:s}=e,[l,t]=(0,r.useState)({svg:[null,null],fields:{}}),a=(0,r.useRef)(),i=(0,r.useRef)(),d=e=>{let{target:s}=e,{svg:n,fields:a}=l;if(s.files){let e=new FileReader;e.readAsText(s.files[0]),e.onload=function(){let a=[...n];a[s.id.at(-1)]=e.result;let r=function(e){let s=RegExp(c("\\w+"),"gmi");return function(e){if(e)return e.reduce((e,s)=>(e.includes(s)||e.push(s),e),[])}(e.match(s))}(e.result);if(r){let e=function(e){let s=m.filter(s=>e.includes(c(s.tag))),n={...l.fields};return s.forEach(e=>{n[e.tag]=e.mock}),n}(r);e?t({svg:a,fields:e}):(alert("Ошибка. Поля не совпадают с заданными полями."),s.value="")}else alert("Ошибка. Поля для редактирования не найдены."),s.value=""},e.onerror=function(){console.log(e.error),alert("Ошибка. Файл загружен с ошибкой."),s.value=""}}},u=e=>{e.preventDefault(),l.svg[0]&&s(l)},f=e=>{e.preventDefault();let s=[l.svg[1],l.svg[0]],n=a.value;a.value=i.value,i.value=n,t({...l,svg:s})},v=l.svg[0]?(0,n.jsxs)("div",{className:"load-form-buttons",children:[(0,n.jsx)("button",{className:"btn btn-primary m-3",onClick:u,children:"Редактировать визитки"}),(0,n.jsx)("button",{className:"btn btn-primary m-3",onClick:f,children:"Поменять местами"})]}):"";return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"row",children:(0,n.jsx)("h1",{children:"Загрузка шаблонов"})}),(0,n.jsx)("div",{className:"row load-form",children:(0,n.jsxs)("form",{children:[(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("div",{className:"col mb-3",children:[(0,n.jsx)("label",{htmlFor:"inputFile0",className:"form-label",children:"Фронтальная сторона:"}),(0,n.jsx)("input",{type:"file",ref:a,accept:".svg",className:"form-control",id:"inputFile0",onChange:d}),(0,n.jsx)("div",{className:"load-files-render",children:(0,n.jsx)(o,{svg:l.svg[0],fields:l.fields})})]}),(0,n.jsxs)("div",{className:"col mb-3",children:[(0,n.jsx)("label",{htmlFor:"inputFile1",className:"form-label",children:"Обратная сторона"}),(0,n.jsx)("input",{type:"file",ref:i,accept:".svg",className:"form-control",id:"inputFile1",onChange:d}),(0,n.jsx)("div",{className:"load-files-render",children:(0,n.jsx)(o,{svg:l.svg[1],fields:l.fields})})]})]}),(0,n.jsx)("div",{className:"row",children:v})]})}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsx)("a",{href:"/static/v2_front.svg",download:"v2_front.svg",children:"Фронт шаблон"}),(0,n.jsx)("a",{href:"/static/v2_rev.svg",download:"v2_rev.svg",children:"Обратн. шаблон"})]})]})}let v={svg:[null,null],fields:{}};var h=function(){let[e,s]=(0,r.useState)(v),l=e=>{s(e)},t=()=>{s(v)},a=[(0,n.jsx)(f,{handleFilesLoaded:l}),(0,n.jsx)(u,{svg:e.svg,startFields:e.fields,handleRefresh:t})],i=e.svg[0]?a[1]:a[0];return(0,n.jsx)("main",{className:"container-xl main",children:i})};function x(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(a(),{children:[(0,n.jsx)("title",{children:"Martian"}),(0,n.jsx)("meta",{name:"description",content:"Martian vizit cards printing house"}),(0,n.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,n.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,n.jsx)(h,{})]})}}},function(e){e.O(0,[234,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);